<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-xs-6 col-lg-6">
                <div class="form-group">
                    <label for="InputFileButton">Browse</label>
                    <input class="btn btn-primary" type="file" id="InputFileButton" onchange="LoadTextFile()">
                </div>
                <textarea id="textarea1" class="form-control" rows="38" columns="20"></textarea>
            </div>
            <div class="col-xs-6 col-lg-6">
                <form class="form-inline">

                    <!-- <div class="checkbox">
                        <label>
                            <input type="checkbox" id="checkbox1"> Show Only :
                        </label>
                    </div> -->

                    <select id="select1" class="form-control" onchange="PopulateSelects('select1')">

                    </select>

                    <select id="select2" class="form-control" onchange="PopulateSelects('select2')">

                    </select>

                    <select id="select3" class="form-control" onchange="PopulateSelects('select3')">

                    </select>

                    <select id="select4" class="form-control" onchange="PopulateSelects('select4')">

                    </select>


                    <button type="button" class="btn btn-primary">Show</button>

                </form>

                <!-- <button id="button2" class="btn btn-default" onclick="PopulateFirstSelect(['interface', 'ip', 'controller'])">PopulateSelect1</button>
                <button id="button3" class="btn btn-default" onclick="ResetElement('select1')">ResetElement</button>
                <button id="button4" class="btn btn-default" onclick="ClearOptions('select1')">ClearOptions</button>
                <button id="button5" class="btn btn-default" onclick="ReadTextAreaContent()">ReadTextArea</button>
                <button id="button6" class="btn btn-default" onclick="ShowAsciiCodeOfChars('show ver ')">ShowAsciiCodeOfChars</button> -->

            </div>
        </div>
    </div>



    <script src="/js/jquery-3.3.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/bootstrap.js"></script>
    <script>

        var rootConfig = new Node('rootConfig');

        function Node(value) {

            this.value = value;
            this.children = [];
            this.parent = null;

            this.setParentNode = function (node) {
                this.parent = node;
            }

            this.getParentNode = function () {
                return this.parent;
            }

            this.addChild = function (node) {
                node.setParentNode(this);
                this.children[this.children.length] = node;
            }

            this.getChildren = function () {
                return this.children;
            }

            this.removeChildren = function () {
                this.children = [];
            }
        }


        // Load textarea by selected config file from input btn

        function LoadTextFile() {
            var file = document.getElementById('InputFileButton').files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var textArea = document.getElementById("textarea1");
                var fileString = e.target.result;
                textArea.value = e.target.result;
                document.getElementById("textarea1").innerHTML = fileString;
                ////////////////////////////////////////////////////////////////////////////////////
                // because it's async, we have to put our logic in this function!

                // reset config tree
                rootConfig.removeChildren();

                var linesOfConfig = document.getElementById("textarea1").value.split("\n");
                CheckEveryLinesOfRawConfig(linesOfConfig);
                var listOfFirstWords = ChildrenValuesInString(rootConfig);
                var preferedItems = ["interface", "ip", "controller", "line", "hostname", "username", "enable", "access-list", "router", "clock", "license", "version"];
                rootConfig = SortNodeChildsBaseOnPreferedItems(rootConfig, preferedItems);

                //Populate Select 1 with FirstWords
                // ResetElement("select1");
                // var sortedFirstWords = ChildrenValuesInString(rootConfig);
                // PopulateFirstSelect(sortedFirstWords);
                // PopulateSelects("select1", rootConfig);
                // PopulateSelect2BaseOnSelect1Option("select1");
                PopulateSelects("select1");

                /////////////////////////////////////////////////////////////////////////////////////

            };
            reader.readAsText(file);


        }

        function CheckEveryLinesOfRawConfig(linesOfConfig) {
            var firstWordsList = [];
            for (var i = 0; i < linesOfConfig.length; i++) {
                var thisLineOfConfig = linesOfConfig[i];
                if (thisLineOfConfig.length == 0) { continue; }
                if (thisLineOfConfig.charAt(0) === "!" || thisLineOfConfig.charAt(0) === " ") { continue; }

                var wordsInThisLine = thisLineOfConfig.split(" ");
                AddThisLineToConfigTree(wordsInThisLine);
            }
        }

        function ChildrenValuesInString(node) {
            var childsValues = [];
            for (i = 0; i < node.children.length; i++) {
                childsValues.push(node.children[i].value);
            }

            return childsValues;
        }

        function SortNodeChildsBaseOnPreferedItems(node, prefItems) {
            var i = 0;
            var index = 0;
            while (i < prefItems.length) {
                var item = prefItems[i];
                var j = 0;
                while (j < node.children.length) {
                    if (item == node.children[j].value) {
                        var temp = node.children[index];
                        node.children[index] = node.children[j];
                        node.children[j] = temp;
                        index++;
                        break;
                    }
                    j++;
                }
                i++;
            }

            return node;
        }

        // Give string array to a Select to populate its options.
        function PopulateSelect(selectId, node) {
            ResetElement(selectId);
            var list = ChildrenValuesInString(node);
            var firstSelect = document.getElementById(selectId);
            for (var i = 0; i < list.length; i++) {
                var option = document.createElement("OPTION");
                var item = document.createTextNode(list[i]);
                option.appendChild(item);
                option.setAttribute("value", list[i]);
                firstSelect.insertBefore(option, firstSelect.lastChild);
            }
        }

        function PopulateSelects(selectId) {
            var thisSelectValue = document.getElementById(selectId).value;
            var list = [];
            switch (selectId) {
                case "select1":
                    ResetElement("select2");
                    ResetElement("select3");
                    ResetElement("select4");
                    if (thisSelectValue == "") {
                        PopulateSelect("select1", rootConfig);
                        thisSelectValue = document.getElementById("select1").value;
                    }
                    list.push(thisSelectValue);
                    var findedNode = LocateLastNodeInList(rootConfig, list)
                    PopulateSelect("select2", findedNode);
                    if(findedNode.children.length > 0) {
                        PopulateSelects("select2");
                    }
                    break;

                case "select2":
                    ResetElement("select3");
                    ResetElement("select4");
                    var select1Value = document.getElementById("select1").value;
                    list.push(select1Value);
                    if (thisSelectValue == "") {
                        break;
                    }
                    else {
                        list.push(thisSelectValue);
                        var findedNode = LocateLastNodeInList(rootConfig, list);
                        if(findedNode.children.length > 0) {
                            PopulateSelect("select3", findedNode);
                            PopulateSelects("select3");
                        }
                    }
                    break;

                case "select3":
                    ResetElement("select4");
                    var select1Value = document.getElementById("select1").value;
                    var select2Value = document.getElementById("select2").value;
                    list.push(select1Value);
                    list.push(select2Value);
                    if (thisSelectValue == "") {
                        break;
                    }
                    else {
                        list.push(thisSelectValue);
                        var findedNode = LocateLastNodeInList(rootConfig, list);
                        if(findedNode.children.length > 0) {
                            PopulateSelect("select4", findedNode);
                        }
                    }
                    break;
                // case select4:

                //     break;

                // default:
                //     break;
            }
        }

        // function PopulateNextSelectBaseOnTheChangeInThisOne(selectId) {
        //     var select1Value = document.getElementById(selectId).value;
        //     var list = [];
        //     list.push(select1Value);
        //     var findedNode = LocateLastNodeInList(rootConfig, list)
        //     PopulateSelect("select2", findedNode);
        // }



        function ResetElement(elementId) {
            var element = document.getElementById(elementId);
            element.options.length = 0;
        }

        function ClearOptions(elementId) {
            var element = document.getElementById(elementId);
            while (element.length > 0)
                element.remove(0);
        }

        function ReadTextAreaContent() {
            var linesOfConfig = document.getElementById("textarea1").value.split("\n");
            ShowAsciiCodeOfChars(linesOfConfig[2]);
        }

        function ShowAsciiCodeOfChars(array) {
            var length = array.length;
            var i = 0;
            while (i < length) {
                alert(array[i] + ' : ' + array.charCodeAt(i));
                i++;
            }
        }



        /////////////////////// This function add words in a line of config to rootConfig tree/////////////////////////////

        function AddThisLineToConfigTree(wordsInThisLine) {
            var precededWords = [];
            wordsInThisLine = DivideInterfacesIntoSubString(wordsInThisLine);
            for (var i = 0; i < wordsInThisLine.length; i++) {
                AddNode(precededWords, wordsInThisLine[i])
                precededWords.push(wordsInThisLine[i]);
            }
        }

        function AddNode(precededWords, node) {             // precededParents: words before node in a line of code
            var parent = LocateLastNodeInList(rootConfig, precededWords);
            InsertNodeUnderItsParent(node, parent);
        }

        function LocateLastNodeInList(startNode, precededNodesList) {   // LocateLastNodeInList(startNode, ["service", "timestamp"])
            var lastNode = startNode
            var index = 0;
            while (index < precededNodesList.length) {
                var childs = lastNode.children;
                for (var i = 0; i < childs.length; i++) {
                    if (childs[i].value == precededNodesList[index]) {
                        lastNode = childs[i];
                        index++;
                        break;
                    }
                }
            }

            return lastNode;
        }



        function InsertNodeUnderItsParent(node, parent) {
            var childsOfParent = parent.children;
            var isBetweenChildsAlready = false;
            for (i = 0; i < childsOfParent.length; i++) {
                if (node == parent.children[i].value) {
                    isBetweenChildsAlready = true;
                    break;
                }
            }
            if (isBetweenChildsAlready == false) {
                parent.addChild(new Node(node));
            }

        }

        function DivideInterfacesIntoSubString(wordsInThisLine) {
            var thisLineOfCode = [];
            thisLineOfCode.push(wordsInThisLine[0]);

            for (var i = 1; i < wordsInThisLine.length; i++) {
                var word = wordsInThisLine[i];
                var j = 0;
                var findDigit = false;
                while (j < word.length) {
                    if (word.charCodeAt(j) >= 48 && word.charCodeAt(j) <= 57) {
                        if (word.charCodeAt(j - 1) >= 65 && word.charCodeAt(j - 1) <= 122) {
                            findDigit = true;
                            thisLineOfCode.push(word.substring(0, j));
                            word = word.substring(j, word.length);
                            var indexOfdot = word.indexOf(".");
                            if (indexOfdot == -1) {
                                thisLineOfCode.push(word);
                            }
                            else {
                                thisLineOfCode.push(word.substring(0, indexOfdot));
                                thisLineOfCode.push(word.substring(indexOfdot, word.length));
                            }

                            break;
                        }
                    }
                    j++;

                }

                if (findDigit == false) {
                    thisLineOfCode.push(word);
                }
            }
            return thisLineOfCode
        }
        ///////////////////////////////////// end of functions that add nodes to tree of config ////////////




    </script>
</body>

</html>